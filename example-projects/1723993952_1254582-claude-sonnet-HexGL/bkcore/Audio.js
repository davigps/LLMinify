var bkcore=bkcore||{};bkcore.Audio={sounds:{},init:()=>{var e=window.AudioContext||window.webkitAudioContext;bkcore.Audio._ctx=e?(bkcore.Audio._panner=(new e).createPanner()).connect(bkcore.Audio._ctx.destination):null,bkcore.Audio.posMultipler=1.5},addSound:(e,n,o,t,i)=>{var r=bkcore.Audio._ctx;if(r){var u={src:null,gainNode:null,bufferNode:null,loop:o},d=new XMLHttpRequest;d.responseType="arraybuffer",d.onload=()=>{r.decodeAudioData(d.response,(e=>{var o=r.createGain();(i?bkcore.Audio._panner:r.destination).connect(o),u.src=e,u.gainNode=o,t()}),(e=>{console.error("Audio decode failed!",e)}))},d.open("GET",e,!0),d.send(null)}else{var a=new Audio;a.addEventListener("canplay",(()=>{a.pause(),a.currentTime=0,t()}),!1),a.autoplay=!0,a.loop=o,a.src=e}bkcore.Audio.sounds[n]=r?u:a},play:e=>{var n=bkcore.Audio._ctx;if(n){var o=n.createBufferSource();o.connect(bkcore.Audio.sounds[e].gainNode),o.buffer=bkcore.Audio.sounds[e].src,o.loop=bkcore.Audio.sounds[e].loop,bkcore.Audio.sounds[e].gainNode.gain.value=1,bkcore.Audio.sounds[e].bufferNode=o,o.start?o.start(0):o.noteOn(0)}else{var t=bkcore.Audio.sounds[e];t.currentTime>0&&(t.pause(),t.currentTime=0),t.play()}},stop:e=>{var n=bkcore.Audio._ctx;if(n){var o=bkcore.Audio.sounds[e].bufferNode;o&&(o.stop?o.stop(n.currentTime):o.noteOff(n.currentTime))}else{var t=bkcore.Audio.sounds[e];t.pause(),t.currentTime=0}},volume:(e,n)=>{(bkcore.Audio._ctx?bkcore.Audio.sounds[e].gainNode.gain:bkcore.Audio.sounds[e]).value=n},setListenerPos:e=>{if(bkcore.Audio._ctx){var n=bkcore.Audio._panner,o=e.normalize(),t=bkcore.Audio.posMultipler;n.setPosition(o.x*t,o.y*t,o.z*t)}},setListenerVelocity:()=>{}};bkcore.Audio.init();
