const BOARD_WIDTH=20,BOARD_HEIGHT=32;let running,speed,board,pixel,snakeOrientation,coinPosition,mouseStart,snake;const movements={N:["N","L","N","W"],L:["N","L","S","L"],S:["S","L","S","W"],W:["N","W","S","W"]},steps={N:[0,-1],L:[1,0],S:[0,1],W:[-1,0]};class SnakePart{constructor(x,y){this.x=x,this.y=y,this.child=null}grow(){this.child?this.child.grow():this.child=new SnakePart(this.x,this.y)}print(){board[this.y][this.x]=1,this.child&&this.child.print()}move(x,y){this.child&&this.child.move(this.x,this.y),this.x=x,this.y=y}hasChild(x,y){return this.x===x&&this.y===y||!!this.child&&this.child.hasChild(x,y)}}function resetVariables(){running=!0,speed=200,board=[],pixel=[10,10],snakeOrientation="S",setCoinPosition(),snake=new SnakePart(10,16)}function setCoinPosition(){coinPosition={x:randomInt(0,19),y:randomInt(0,31)}}document.body.onload=()=>{startUp(),runGame()};function runGame(){const e=document.getElementById("board"),t=document.getElementById("app");t&&e&&(e.width=t.offsetWidth,e.height=t.offsetHeight,resetVariables(),getParams(e),renderFrame(e))}function renderFrame(e){clearBoard(),snake.print(),board[coinPosition.y][coinPosition.x]=2,drawBoard(e);const t=snake.x+steps[snakeOrientation][0],i=snake.y+steps[snakeOrientation][1];t>=0&&t<20&&i>=0&&i<32?(2===board[i][t]?(setCoinPosition(),snake.grow()):1===board[i][t]&&(running=!1),snake.move(t,i),snake.print()):running=!1,running&&setTimeout((()=>renderFrame(e)),speed)}function drawBoard(e){const t=e.getContext("2d");if(t){t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height);for(let e=0;e<32;e++)for(let i=0;i<20;i++)2===board[e][i]?(t.fillStyle="#f2b500",t.fillRect(i*pixel[0],e*pixel[1],pixel[0],pixel[1])):1===board[e][i]&&(t.fillStyle="#169638",t.fillRect(i*pixel[0],e*pixel[1],pixel[0],pixel[1]))}}function startUp(){const e=document.getElementById("board");e.addEventListener("mousedown",(e=>{e.preventDefault();const t=[e.offsetX,e.offsetY];mouseStart=t})),e.addEventListener("mouseup",(e=>{e.preventDefault();const t=[e.offsetX,e.offsetY];handleCommand(mouseStart[0],mouseStart[1],t[0],t[1])})),e.addEventListener("touchstart",(e=>{e.preventDefault();const t=[e.touches[0].pageX,e.touches[0].pageY];mouseStart=t})),e.addEventListener("touchend",(e=>{e.preventDefault();const t=[e.changedTouches[0].pageX,e.changedTouches[0].pageY];handleCommand(mouseStart[0],mouseStart[1],t[0],t[1])})),document.body.addEventListener("keydown",(e=>{const t=e.which||e.keyCode;let i=0;38!==t&&87!==t||(i=0),39!==t&&68!==t||(i=1),40!==t&&83!==t||(i=2),37!==t&&65!==t||(i=3),snakeOrientation=movements[snakeOrientation][i]}))}function handleCommand(e,t,i,n){const o=i-e,r=n-t;let a;Math.abs(o)>Math.abs(r)?o>0?a=1:a=3:r>0?a=2:a=0,snakeOrientation=movements[snakeOrientation][a]}function getParams(e){pixel=[e.width/20,e.height/32],clearBoard()}function randomInt(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function clearBoard(){board=[];for(let e=0;e<32;e++){board.push([]);for(let t=0;t<20;t++)board[e].push(0)}}
